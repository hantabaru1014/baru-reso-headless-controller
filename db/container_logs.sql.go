// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: container_logs.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const getContainerLogsByTag = `-- name: GetContainerLogsByTag :many
SELECT tag, ts, data
FROM container_logs
WHERE tag = $1
  AND ($2::timestamp IS NULL OR ts < $2)
  AND ($3::timestamp IS NULL OR ts >= $3)
ORDER BY ts DESC
LIMIT CASE WHEN $4 > 0 THEN $4 ELSE 1000 END
`

type GetContainerLogsByTagParams struct {
	Tag     pgtype.Text
	Column2 pgtype.Timestamp
	Column3 pgtype.Timestamp
	Column4 interface{}
}

// 特定のタグ（hostID + instanceID）のログを取得
func (q *Queries) GetContainerLogsByTag(ctx context.Context, arg GetContainerLogsByTagParams) ([]ContainerLog, error) {
	rows, err := q.db.Query(ctx, getContainerLogsByTag,
		arg.Tag,
		arg.Column2,
		arg.Column3,
		arg.Column4,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ContainerLog
	for rows.Next() {
		var i ContainerLog
		if err := rows.Scan(&i.Tag, &i.Ts, &i.Data); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const insertContainerLog = `-- name: InsertContainerLog :exec
INSERT INTO container_logs (tag, ts, data) VALUES ($1, $2, $3)
`

type InsertContainerLogParams struct {
	Tag  pgtype.Text
	Ts   pgtype.Timestamp
	Data []byte
}

// テスト用
func (q *Queries) InsertContainerLog(ctx context.Context, arg InsertContainerLogParams) error {
	_, err := q.db.Exec(ctx, insertContainerLog, arg.Tag, arg.Ts, arg.Data)
	return err
}
